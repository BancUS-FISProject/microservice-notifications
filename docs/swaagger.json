{
  "components": {
    "schemas": {
      "NotificationView": {
        "description": "Vista de lectura de una notificación devuelta por la API.",
        "properties": {
          "_id": {
            "description": "Identificador único de la notificación.",
            "title": "Id",
            "type": "string"
          },
          "createdAt": {
            "description": "Fecha y hora de creación de la notificación.",
            "format": "date-time",
            "title": "Createdat",
            "type": "string"
          },
          "email": {
            "anyOf": [
              {
                "format": "email",
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Correo electrónico asociado al usuario.",
            "title": "Email"
          },
          "email_reason": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Motivo del envío o no del correo electrónico.",
            "title": "Email Reason"
          },
          "email_sent": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Indica si se ha enviado un correo electrónico al usuario.",
            "title": "Email Sent"
          },
          "message": {
            "description": "Contenido principal de la notificación.",
            "title": "Message",
            "type": "string"
          },
          "metadata": {
            "anyOf": [
              {
                "additionalProperties": true,
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "description": "Información adicional asociada a la notificación.",
            "title": "Metadata"
          },
          "plan": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Plan de suscripción del usuario.",
            "title": "Plan"
          },
          "title": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Título de la notificación.",
            "title": "Title"
          },
          "type": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "default": null,
            "description": "Tipo de evento que originó la notificación.",
            "title": "Type"
          },
          "userId": {
            "description": "IBAN identificador del usuario propietario de la notificación.",
            "title": "Userid",
            "type": "string"
          }
        },
        "required": [
          "_id",
          "userId",
          "message",
          "createdAt"
        ],
        "title": "NotificationView",
        "type": "object"
      }
    }
  },
  "info": {
    "title": "Notifications Service",
    "version": "0.1.0"
  },
  "openapi": "3.1.0",
  "paths": {
    "/v1/notifications/": {
      "get": {
        "description": "\nEndpoint pensado para tareas de administración,\nmonitorización o debugging interno.",
        "operationId": "get_get_all_notifications",
        "parameters": [],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "items": {
                    "$ref": "#/components/schemas/NotificationView"
                  },
                  "type": "array"
                }
              }
            },
            "description": "Built-in mutable sequence.\n\nIf no argument is given, the constructor creates a new empty list.\nThe argument must be an iterable if specified."
          }
        },
        "summary": "Devuelve todas las notificaciones del sistema.",
        "tags": [
          "Consulta - Admin"
        ]
      }
    },
    "/v1/notifications/events": {
      "post": {
        "description": "\nRecibe eventos procedentes de otros microservicios (login, pagos,\nfraude, etc.) y genera notificaciones persistidas en base de datos.\nDependiendo del tipo de evento, puede desencadenar el envío de correos\nelectrónicos mediante SendGrid.",
        "operationId": "post_receive_event",
        "parameters": [],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "description": "Evento recibido desde otros microservicios del sistema.",
                "properties": {
                  "metadata": {
                    "anyOf": [
                      {
                        "additionalProperties": true,
                        "type": "object"
                      },
                      {
                        "type": "null"
                      }
                    ],
                    "description": "Información contextual adicional enviada por el microservicio emisor.",
                    "title": "Metadata"
                  },
                  "plan": {
                    "anyOf": [
                      {
                        "enum": [
                          "basico",
                          "premium",
                          "pro"
                        ],
                        "type": "string"
                      },
                      {
                        "type": "null"
                      }
                    ],
                    "default": null,
                    "description": "Plan de suscripción del usuario en el momento del evento.",
                    "title": "Plan"
                  },
                  "type": {
                    "description": "Tipo de evento que debe ser procesado por el servicio de notificaciones.",
                    "enum": [
                      "login",
                      "transaction",
                      "scheduled-payment",
                      "history-request",
                      "fraud-detected"
                    ],
                    "title": "Type",
                    "type": "string"
                  },
                  "userId": {
                    "description": "IBAN identificador del usuario que ha generado el evento.",
                    "title": "Userid",
                    "type": "string"
                  }
                },
                "required": [
                  "userId",
                  "type"
                ],
                "title": "NotificationEvent",
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "201": {
            "content": {
              "application/json": {
                "schema": {
                  "description": "Vista de lectura de una notificación devuelta por la API.",
                  "properties": {
                    "_id": {
                      "description": "Identificador único de la notificación.",
                      "title": "Id",
                      "type": "string"
                    },
                    "createdAt": {
                      "description": "Fecha y hora de creación de la notificación.",
                      "format": "date-time",
                      "title": "Createdat",
                      "type": "string"
                    },
                    "email": {
                      "anyOf": [
                        {
                          "format": "email",
                          "type": "string"
                        },
                        {
                          "type": "null"
                        }
                      ],
                      "default": null,
                      "description": "Correo electrónico asociado al usuario.",
                      "title": "Email"
                    },
                    "email_reason": {
                      "anyOf": [
                        {
                          "type": "string"
                        },
                        {
                          "type": "null"
                        }
                      ],
                      "default": null,
                      "description": "Motivo del envío o no del correo electrónico.",
                      "title": "Email Reason"
                    },
                    "email_sent": {
                      "anyOf": [
                        {
                          "type": "boolean"
                        },
                        {
                          "type": "null"
                        }
                      ],
                      "default": null,
                      "description": "Indica si se ha enviado un correo electrónico al usuario.",
                      "title": "Email Sent"
                    },
                    "message": {
                      "description": "Contenido principal de la notificación.",
                      "title": "Message",
                      "type": "string"
                    },
                    "metadata": {
                      "anyOf": [
                        {
                          "additionalProperties": true,
                          "type": "object"
                        },
                        {
                          "type": "null"
                        }
                      ],
                      "description": "Información adicional asociada a la notificación.",
                      "title": "Metadata"
                    },
                    "plan": {
                      "anyOf": [
                        {
                          "type": "string"
                        },
                        {
                          "type": "null"
                        }
                      ],
                      "default": null,
                      "description": "Plan de suscripción del usuario.",
                      "title": "Plan"
                    },
                    "title": {
                      "anyOf": [
                        {
                          "type": "string"
                        },
                        {
                          "type": "null"
                        }
                      ],
                      "default": null,
                      "description": "Título de la notificación.",
                      "title": "Title"
                    },
                    "type": {
                      "anyOf": [
                        {
                          "type": "string"
                        },
                        {
                          "type": "null"
                        }
                      ],
                      "default": null,
                      "description": "Tipo de evento que originó la notificación.",
                      "title": "Type"
                    },
                    "userId": {
                      "description": "IBAN identificador del usuario propietario de la notificación.",
                      "title": "Userid",
                      "type": "string"
                    }
                  },
                  "required": [
                    "_id",
                    "userId",
                    "message",
                    "createdAt"
                  ],
                  "title": "NotificationView",
                  "type": "object"
                }
              }
            },
            "description": "Vista de lectura de una notificación devuelta por la API."
          }
        },
        "summary": "Endpoint principal del microservicio de notificaciones.",
        "tags": [
          "Eventos"
        ]
      }
    },
    "/v1/notifications/health": {
      "get": {
        "description": "\nPensado para ser utilizado como endpoint de liveness/readiness\nen entornos Docker o Kubernetes.",
        "operationId": "get_health_check",
        "parameters": [],
        "responses": {

        },
        "summary": "Healthcheck del microservicio.",
        "tags": [
          "Health"
        ]
      }
    },
    "/v1/notifications/test-email": {
      "post": {
        "description": "\nEnvía un correo electrónico de prueba utilizando la configuración\nactual del servicio de notificaciones.",
        "operationId": "post_test_email",
        "parameters": [],
        "responses": {

        },
        "summary": "Endpoint de prueba para verificar la integración con SendGrid.",
        "tags": [
          "Debug"
        ]
      }
    },
    "/v1/notifications/user/{userId}": {
      "get": {
        "description": "\nLas notificaciones se devuelven ordenadas por fecha de creación,\nde la más reciente a la más antigua.",
        "operationId": "get_get_notifications_by_user",
        "parameters": [
          {
            "in": "path",
            "name": "userId",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "items": {
                    "$ref": "#/components/schemas/NotificationView"
                  },
                  "type": "array"
                }
              }
            },
            "description": "Built-in mutable sequence.\n\nIf no argument is given, the constructor creates a new empty list.\nThe argument must be an iterable if specified."
          }
        },
        "summary": "Devuelve todas las notificaciones asociadas a un usuario concreto.",
        "tags": [
          "Consulta - Usuario"
        ]
      }
    },
    "/v1/notifications/{notification_id}": {
      "delete": {
        "description": "\nSi la notificación no existe, se devuelve un error 404.",
        "operationId": "delete_delete_notification",
        "parameters": [
          {
            "in": "path",
            "name": "notification_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {

        },
        "summary": "Elimina una notificación existente por su identificador.",
        "tags": [
          "Admin - Delete"
        ]
      },
      "put": {
        "description": "\nSolo se modificarán los campos presentes en el payload.",
        "operationId": "put_update_notification",
        "parameters": [
          {
            "in": "path",
            "name": "notification_id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "description": "Payload utilizado para actualizar parcialmente una notificación existente.",
                "properties": {
                  "email_reason": {
                    "anyOf": [
                      {
                        "type": "string"
                      },
                      {
                        "type": "null"
                      }
                    ],
                    "default": null,
                    "description": "Motivo actualizado del envío o no del correo electrónico.",
                    "title": "Email Reason"
                  },
                  "email_sent": {
                    "anyOf": [
                      {
                        "type": "boolean"
                      },
                      {
                        "type": "null"
                      }
                    ],
                    "default": null,
                    "description": "Indica si el correo electrónico ha sido enviado.",
                    "title": "Email Sent"
                  },
                  "message": {
                    "anyOf": [
                      {
                        "type": "string"
                      },
                      {
                        "type": "null"
                      }
                    ],
                    "default": null,
                    "description": "Nuevo contenido del mensaje.",
                    "title": "Message"
                  },
                  "metadata": {
                    "anyOf": [
                      {
                        "additionalProperties": true,
                        "type": "object"
                      },
                      {
                        "type": "null"
                      }
                    ],
                    "description": "Información contextual adicional actualizada.",
                    "title": "Metadata"
                  },
                  "plan": {
                    "anyOf": [
                      {
                        "enum": [
                          "basico",
                          "premium",
                          "pro"
                        ],
                        "type": "string"
                      },
                      {
                        "type": "null"
                      }
                    ],
                    "default": null,
                    "description": "Nuevo plan de suscripción del usuario.",
                    "title": "Plan"
                  },
                  "title": {
                    "anyOf": [
                      {
                        "type": "string"
                      },
                      {
                        "type": "null"
                      }
                    ],
                    "default": null,
                    "description": "Nuevo título de la notificación.",
                    "title": "Title"
                  },
                  "type": {
                    "anyOf": [
                      {
                        "enum": [
                          "login",
                          "transaction",
                          "scheduled-payment",
                          "history-request",
                          "fraud-detected"
                        ],
                        "type": "string"
                      },
                      {
                        "type": "null"
                      }
                    ],
                    "default": null,
                    "description": "Nuevo tipo de evento asociado a la notificación.",
                    "title": "Type"
                  }
                },
                "title": "NotificationUpdate",
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "description": "Vista de lectura de una notificación devuelta por la API.",
                  "properties": {
                    "_id": {
                      "description": "Identificador único de la notificación.",
                      "title": "Id",
                      "type": "string"
                    },
                    "createdAt": {
                      "description": "Fecha y hora de creación de la notificación.",
                      "format": "date-time",
                      "title": "Createdat",
                      "type": "string"
                    },
                    "email": {
                      "anyOf": [
                        {
                          "format": "email",
                          "type": "string"
                        },
                        {
                          "type": "null"
                        }
                      ],
                      "default": null,
                      "description": "Correo electrónico asociado al usuario.",
                      "title": "Email"
                    },
                    "email_reason": {
                      "anyOf": [
                        {
                          "type": "string"
                        },
                        {
                          "type": "null"
                        }
                      ],
                      "default": null,
                      "description": "Motivo del envío o no del correo electrónico.",
                      "title": "Email Reason"
                    },
                    "email_sent": {
                      "anyOf": [
                        {
                          "type": "boolean"
                        },
                        {
                          "type": "null"
                        }
                      ],
                      "default": null,
                      "description": "Indica si se ha enviado un correo electrónico al usuario.",
                      "title": "Email Sent"
                    },
                    "message": {
                      "description": "Contenido principal de la notificación.",
                      "title": "Message",
                      "type": "string"
                    },
                    "metadata": {
                      "anyOf": [
                        {
                          "additionalProperties": true,
                          "type": "object"
                        },
                        {
                          "type": "null"
                        }
                      ],
                      "description": "Información adicional asociada a la notificación.",
                      "title": "Metadata"
                    },
                    "plan": {
                      "anyOf": [
                        {
                          "type": "string"
                        },
                        {
                          "type": "null"
                        }
                      ],
                      "default": null,
                      "description": "Plan de suscripción del usuario.",
                      "title": "Plan"
                    },
                    "title": {
                      "anyOf": [
                        {
                          "type": "string"
                        },
                        {
                          "type": "null"
                        }
                      ],
                      "default": null,
                      "description": "Título de la notificación.",
                      "title": "Title"
                    },
                    "type": {
                      "anyOf": [
                        {
                          "type": "string"
                        },
                        {
                          "type": "null"
                        }
                      ],
                      "default": null,
                      "description": "Tipo de evento que originó la notificación.",
                      "title": "Type"
                    },
                    "userId": {
                      "description": "IBAN identificador del usuario propietario de la notificación.",
                      "title": "Userid",
                      "type": "string"
                    }
                  },
                  "required": [
                    "_id",
                    "userId",
                    "message",
                    "createdAt"
                  ],
                  "title": "NotificationView",
                  "type": "object"
                }
              }
            },
            "description": "Vista de lectura de una notificación devuelta por la API."
          }
        },
        "summary": "Actualiza los campos de una notificación existente.",
        "tags": [
          "Notifications - Update"
        ]
      }
    }
  },
  "tags": [
    {
      "description": "API version 1",
      "name": "v1"
    }
  ]
}